---
title: "Secret Key Setup"
description: "How to obtain and configure Supabase secret API keys"
---

# Secret API Key Setup

## Overview

This application uses **Secret API Keys** (`sb_secret_...`) instead of the deprecated `service_role` JWT-based keys. Secret keys are the recommended approach for backend operations and provide better security and easier rotation.

## Benefits of Secret Keys

- ✅ **Better Security**: Cannot be used in browsers (returns 401 automatically)
- ✅ **Easier Rotation**: Can be rotated independently without downtime
- ✅ **No JWT Coupling**: Not tied to the JWT secret rotation
- ✅ **Same Functionality**: Provides full access like service_role keys

## Getting Your Secret Key

1. Go to your Supabase Dashboard
2. Navigate to **Settings** → **API** → **API Keys**
3. Click **Create new API Keys** (if you don't have one)
4. Copy the **Secret key** (starts with `sb_secret_...`)

## Configuration

Add the secret key to your `backend/.env` file:

```env
SUPABASE_SECRET_KEY=sb_secret_your_secret_key_here
```

## Usage in Code

The secret key is used for:
- **Admin operations**: Creating users, managing auth (via `supabase.auth.admin`)
- **Token verification**: Verifying JWT tokens in authentication middleware
- **Backend-only operations**: Any operation that needs to bypass RLS

## Security Best Practices

1. **Never expose in frontend**: Secret keys should only be used in backend code
2. **Environment variables only**: Store in `.env` files, never commit to git
3. **Separate keys per service**: Consider using different secret keys for different backend components
4. **Regular rotation**: Rotate keys periodically (at least annually)
5. **Monitor usage**: Check the "Last used" indicator in the Supabase dashboard

## Migration from service_role

If you were previously using `service_role` keys:

1. Create a new secret key in Supabase Dashboard
2. Update `backend/.env` to use `SUPABASE_SECRET_KEY` instead of `SUPABASE_SERVICE_ROLE_KEY`
3. The code has already been updated to use secret keys
4. Test your application
5. Once confirmed working, you can disable the old `service_role` key in the dashboard

## Troubleshooting

**Error: "Invalid API key"**
- Verify the key starts with `sb_secret_`
- Check for typos or extra spaces
- Ensure the key is from the correct Supabase project

**Error: "Unauthorized" when using in browser**
- This is expected! Secret keys cannot be used in browsers
- Use the anon/publishable key for frontend operations

**Admin operations failing**
- Ensure you're using the secret key (not anon key) for admin operations
- Check that the key has not been disabled in the Supabase dashboard

